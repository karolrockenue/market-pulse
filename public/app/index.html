<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Market Pulse Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/typography@0.5.x/dist/typography.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Manrope:wght@400;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg-primary: #f7f8fc;
        --bg-secondary: #ffffff;
        --text-primary: #1e293b;
        --text-secondary: #64748b;
        --border-color: #e2e8f0;
        --accent-primary: #60a5fa;
        --highlight-color: #eff6ff;
        --font-sans: "Inter", sans-serif;
        --font-data: "Manrope", sans-serif;
      }
      body {
        font-family: var(--font-sans);
        background-color: var(--bg-primary);
        color: var(--text-primary);
      }
      .sidebar {
        background-color: var(--bg-secondary);
        border-right: 1px solid var(--border-color);
      }
      .header {
        background-color: var(--bg-secondary);
        border-bottom: 1px solid var(--border-color);
      }
      .kpi-card {
        background-color: var(--bg-secondary);
        border: 1px solid var(--border-color);
        transition: all 0.2s ease-in-out;
        cursor: pointer;
      }
      .kpi-card:hover {
        transform: translateY(-4px);
        border-color: var(--accent-primary);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      }
      .kpi-card.active {
        border-color: var(--accent-primary);
        box-shadow: 0 0 0 2px var(--accent-primary);
      }
      #kpi-card-container:has(.kpi-card.active) .kpi-card:not(.active) {
        opacity: 0.6;
        transition: opacity 0.3s ease-in-out;
      }
      #kpi-card-container:has(.kpi-card.active) .kpi-card:not(.active):hover {
        opacity: 1;
      }
      .table-container {
        background-color: var(--bg-secondary);
        border: 1px solid var(--border-color);
      }
      .table-container::-webkit-scrollbar {
        width: 6px;
      }
      .table-container::-webkit-scrollbar-track {
        background: #f1f5f9;
      }
      .table-container::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 3px;
      }
      .table-container::-webkit-scrollbar-thumb:hover {
        background: #a0aec0;
      }
      .date-picker {
        background-color: var(--bg-secondary);
        border: 1px solid var(--border-color);
        color: var(--text-primary);
      }
      .brand-text {
        color: var(--accent-primary);
      }
      .font-data {
        font-family: var(--font-data);
        font-variant-numeric: tabular-nums;
      }
      .control-btn {
        padding: 6px 12px;
        font-size: 12px;
        font-weight: 500;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        transition: all 0.2s;
      }
      .control-btn:hover {
        background-color: #f1f5f9;
        border-color: #94a3b8;
      }
      .control-btn.active {
        background-color: var(--accent-primary);
        color: white;
        border-color: var(--accent-primary);
      }
      .dropdown-content {
        position: absolute;
        background-color: #ffffff;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.1);
        z-index: 10;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        right: 0;
        margin-top: 8px;
        padding: 8px 0;
      }
      #dashboard-content-wrapper.hidden-content {
        opacity: 0;
      }
      #dashboard-content-wrapper.visible-content {
        opacity: 1;
        transition: opacity 0.5s ease-in-out;
      }
      #data-display-wrapper.loading {
        opacity: 0.5;
        filter: blur(2px);
        transition: opacity 0.3s ease, filter 0.3s ease;
      }
      [x-cloak] {
        display: none !important;
      }
    </style>
  </head>
  <body class="antialiased" x-data="dashboardPage()" x-cloak>
    <div class="flex flex-col lg:flex-row min-h-screen">
      <aside class="sidebar w-full lg:w-64 lg:flex-shrink-0 flex flex-col">
        <div
          class="h-16 flex items-center px-6 border-b lg:border-b-0 border-r-0 lg:border-r border-[var(--border-color)]"
        >
          <svg
            class="h-8 w-auto brand-text"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="12" y1="20" x2="12" y2="10"></line>
            <line x1="18" y1="20" x2="18" y2="4"></line>
            <line x1="6" y1="20" x2="6" y2="16"></line>
          </svg>
          <span class="ml-3 text-lg font-bold text-gray-800">Market Pulse</span>
        </div>
        <nav class="flex-1 px-4 py-4 space-y-1">
          <a
            href="/app/"
            class="flex items-center px-4 py-2.5 text-sm font-medium bg-blue-50 text-blue-700 rounded-lg"
          >
            <svg
              class="h-5 w-5 mr-3"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path
                d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"
              ></path>
            </svg>
            Dashboard
          </a>
          <a
            href="/app/reports.html"
            class="flex items-center px-4 py-2.5 text-sm font-medium text-gray-600 hover:bg-gray-50 hover:text-gray-900 rounded-lg"
          >
            <svg
              class="h-5 w-5 mr-3"
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M3 3v18h18" />
              <path d="m19 9-5 5-4-4-3 3" />
            </svg>
            Reports
          </a>
          <a
            id="admin-nav-link"
            href="/admin/"
            x-ref="adminNavLink"
            class="flex items-center px-4 py-2.5 text-sm font-medium text-gray-600 hover:bg-gray-50 hover:text-gray-900 rounded-lg"
            style="display: none"
          >
            <svg
              class="h-5 w-5 mr-3"
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            </svg>
            Admin Panel
          </a>
        </nav>
      </aside>

      <div class="flex-1 flex flex-col">
        <header
          class="header h-auto md:h-16 flex flex-col md:flex-row items-start md:items-center justify-between p-4 md:px-8 flex-shrink-0 sticky top-0 z-20"
        >
          <h1 class="text-xl font-semibold text-gray-800 mb-4 md:mb-0">
            Dashboard
          </h1>
          <div class="flex items-center flex-wrap gap-4 md:gap-6">
            <div class="flex items-center gap-2">
              <div class="relative flex h-3 w-3">
                <span
                  class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"
                ></span
                ><span
                  class="relative inline-flex rounded-full h-3 w-3 bg-green-500"
                ></span>
              </div>
              <p
                id="data-timestamp"
                class="text-xs text-gray-500"
                x-text="lastRefreshText"
              ></p>
            </div>

            <div @click.away="propertyDropdownOpen = false" class="relative">
              <button
                @click="propertyDropdownOpen = !propertyDropdownOpen"
                class="flex items-center gap-2 text-sm font-medium text-gray-600 hover:text-gray-900"
                :disabled="!hasProperties"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="h-5 w-5 text-gray-400"
                >
                  <path
                    d="M3 9V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H9l-4-4Z"
                  />
                  <path d="M8 18v-2a2 2 0 0 0-2-2H4" />
                  <path d="M12 12h.01" />
                  <path d="M16 12h.01" />
                  <path d="M12 16h.01" />
                  <path d="M16 16h.01" />
                  <path d="M8 12h.01" />
                </svg>
                <span
                  id="current-property-name"
                  x-text="currentPropertyName"
                ></span>
                <svg
                  class="h-4 w-4 text-gray-400"
                  viewBox="0 0 20 20"
                  fill="currentColor"
                >
                  <path
                    fill-rule="evenodd"
                    d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                    clip-rule="evenodd"
                  />
                </svg>
              </button>
              <div
                x-show="propertyDropdownOpen"
                x-transition
                class="dropdown-content"
              >
                <template
                  x-for="property in properties"
                  :key="property.property_id"
                >
                  <a
                    href="#"
                    @click.prevent="switchProperty(property.property_id); propertyDropdownOpen = false;"
                    class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                    x-text="property.property_name"
                  ></a>
                </template>
              </div>
            </div>

            <div @click.away="userDropdownOpen = false" class="relative">
              <button
                @click="userDropdownOpen = !userDropdownOpen"
                class="flex items-center gap-2"
              >
                <img
                  class="h-9 w-9 rounded-full object-cover"
                  src="https://placehold.co/100x100/E2E8F0/4A5568?text=KM"
                  alt="Your avatar"
                />
                <div>
                  <p class="text-sm font-semibold">Karol Marcu</p>
                  <p class="text-xs text-gray-400">Administrator</p>
                </div>
                <svg
                  class="h-4 w-4 text-gray-400"
                  viewBox="0 0 20 20"
                  fill="currentColor"
                >
                  <path
                    fill-rule="evenodd"
                    d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                    clip-rule="evenodd"
                  />
                </svg>
              </button>
              <div
                x-show="userDropdownOpen"
                x-transition
                class="dropdown-content"
              >
                <a
                  href="#"
                  class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 opacity-50 cursor-not-allowed"
                  >Profile</a
                >
                <hr class="my-1 border-gray-200" />
                <a
                  href="mailto:support@market-pulse.io"
                  class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                  >Support</a
                >
                <button
                  @click="isLegalModalOpen = true; userDropdownOpen = false"
                  class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                >
                  Legal
                </button>
                <hr class="my-1 border-gray-200" />
                <button
                  @click="logout()"
                  class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                >
                  Log Out
                </button>
              </div>
            </div>
          </div>
        </header>

        <main class="flex-1 p-4 md:p-8 relative">
          <div
            x-show="error.show"
            x-transition
            class="fixed top-20 right-8 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg shadow-lg z-50 flex items-center"
          >
            <svg
              class="fill-current h-6 w-6 text-red-500 mr-4"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 20 20"
            >
              <path
                d="M12.432 0c1.34 0 2.01 1.29 1.207 2.468L7.12 12.03a.998.998 0 01-1.414.001L.293 6.468A1.5 1.5 0 012.414 4.5L6.414 8.5l4.293-4.293a1 1 0 011.414 0z"
              />
            </svg>
            <span x-text="error.message"></span>
            <button
              @click="error.show = false"
              class="ml-6 font-bold text-xl text-red-700 hover:text-red-900"
            >
              &times;
            </button>
          </div>

          <template x-if="!isInitialLoading && !hasProperties">
            <div
              class="text-center p-12 bg-white rounded-lg border border-gray-200"
            >
              <svg
                class="mx-auto h-12 w-12 text-gray-400"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M8.25 21v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21m0 0h4.5V3.545M12.75 21h7.5V10.75M2.25 21h1.5m18 0h-18M2.25 9l4.5-1.636M18.75 3l-1.5.545m0 6.205l3 1m-3-1l-1.5.545m0 0l-2.25 1.318m-2.25-1.318l2.25 1.318m0 0l2.25 1.318m-2.25-1.318L12 12.75l-2.25 1.318m2.25-1.318l-2.25 1.318m0 0l-2.25 1.318m2.25-1.318l2.25 1.318"
                />
              </svg>
              <h3 class="mt-2 text-lg font-medium text-gray-900">
                No Properties Connected
              </h3>
              <p class="mt-1 text-sm text-gray-500">
                This account does not have any hotel properties linked to it.
              </p>
              <div class="mt-6">
                <a
                  href="/api/auth/cloudbeds"
                  class="inline-flex items-center rounded-md bg-blue-600 px-3.5 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-blue-500"
                >
                  <svg
                    class="-ml-0.5 mr-1.5 h-5 w-5"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M13.5 10.5V6.75a4.5 4.5 0 119 0v3.75M3.75 21.75h16.5a1.5 1.5 0 001.5-1.5v-6a1.5 1.5 0 00-1.5-1.5H3.75a1.5 1.5 0 00-1.5 1.5v6a1.5 1.5 0 001.5 1.5z"
                    />
                  </svg>
                  Connect with Cloudbeds
                </a>
              </div>
            </div>
          </template>

          <div
            id="dashboard-content-wrapper"
            class="opacity-0 transition-opacity duration-500"
            :class="{ 'opacity-100': !isLoading.properties && hasProperties }"
          >
            <div
              class="bg-white p-4 rounded-xl border border-gray-200 mb-8 flex flex-col gap-4"
            >
              <div class="flex flex-wrap items-center gap-4">
                <div class="flex items-center gap-2">
                  <svg
                    class="h-5 w-5 text-gray-400"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <rect
                      x="3"
                      y="4"
                      width="18"
                      height="18"
                      rx="2"
                      ry="2"
                    ></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line></svg
                  ><span class="font-semibold text-gray-600 text-sm"
                    >Date Range:</span
                  >
                </div>
                <div class="flex items-center gap-3 ml-auto">
                  <input
                    type="date"
                    x-model="dates.start"
                    @change="activePreset = ''"
                    class="date-picker text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2"
                  /><span class="text-gray-400">-</span
                  ><input
                    type="date"
                    x-model="dates.end"
                    @change="activePreset = ''"
                    class="date-picker text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2"
                  /><button
                    @click="runReport()"
                    class="px-5 py-2 text-sm font-semibold text-white bg-blue-500 rounded-lg hover:bg-blue-600 transition flex items-center justify-center"
                  >
                    Run
                  </button>
                </div>
              </div>
              <div
                class="flex flex-wrap items-center gap-4 border-t border-dashed pt-4 mt-2"
              >
                <div class="flex items-center gap-2">
                  <span class="text-xs font-bold text-gray-400 uppercase mr-2"
                    >Display:</span
                  ><button
                    @click="setGranularity('daily')"
                    :class="{'active': granularity === 'daily'}"
                    class="control-btn"
                  >
                    Daily</button
                  ><button
                    @click="setGranularity('weekly')"
                    :class="{'active': granularity === 'weekly'}"
                    class="control-btn"
                  >
                    Weekly</button
                  ><button
                    @click="setGranularity('monthly')"
                    :class="{'active': granularity === 'monthly'}"
                    class="control-btn"
                  >
                    Monthly
                  </button>
                </div>
                <div class="flex items-center gap-2 ml-auto">
                  <span class="text-xs font-bold text-gray-400 uppercase mr-2"
                    >Presets:</span
                  ><button
                    @click="setPreset('current-month')"
                    :class="{'active': activePreset === 'current-month'}"
                    class="control-btn"
                  >
                    Current Month</button
                  ><button
                    @click="setPreset('next-month')"
                    :class="{'active': activePreset === 'next-month'}"
                    class="control-btn"
                  >
                    Next Month</button
                  ><button
                    @click="setPreset('this-year')"
                    :class="{'active': activePreset === 'this-year'}"
                    class="control-btn"
                  >
                    This Year
                  </button>
                </div>
              </div>
            </div>

            <template x-if="isLoading.kpis">
              <div
                class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8 animate-pulse"
              >
                <div class="h-[108px] bg-gray-200 rounded-lg"></div>
                <div class="h-[108px] bg-gray-200 rounded-lg"></div>
                <div class="h-[108px] bg-gray-200 rounded-lg"></div>
              </div>
            </template>
            <template x-if="!isLoading.kpis">
              <div
                id="kpi-card-container"
                class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"
              >
                <template
                  x-for="metric in ['occupancy', 'adr', 'revpar']"
                  :key="metric"
                >
                  <div
                    :class="{'active': activeMetric === metric}"
                    @click="setActiveMetric(metric)"
                    class="kpi-card p-5 rounded-lg"
                  >
                    <div class="flex justify-between items-start">
                      <p
                        class="text-sm text-gray-500 font-medium capitalize"
                        x-text="metric"
                      ></p>
                      <p
                        class="text-sm font-bold font-data"
                        :class="kpi[metric]?.deltaClass"
                        x-text="kpi[metric]?.delta"
                      ></p>
                    </div>
                    <div class="mt-2 grid grid-cols-2 gap-4 items-end">
                      <div>
                        <p class="text-xs text-gray-400">Your Hotel</p>
                        <p
                          class="text-3xl font-extrabold text-gray-800 font-data"
                          x-text="kpi[metric]?.your"
                        ></p>
                      </div>
                      <div class="text-right">
                        <p class="text-xs text-gray-400">Market</p>
                        <p
                          class="text-2xl font-bold text-gray-500 font-data"
                          x-text="kpi[metric]?.market"
                        ></p>
                      </div>
                    </div>
                  </div>
                </template>
              </div>
            </template>

            <template x-if="isLoading.chart">
              <div
                class="bg-gray-200 p-6 rounded-xl mb-8 animate-pulse h-[368px]"
              ></div>
            </template>
            <template x-if="!isLoading.chart">
              <div
                class="relative bg-white p-6 rounded-xl border border-gray-200 mb-8"
              >
                <h2
                  id="comparison-chart-title"
                  class="text-xl font-semibold text-gray-800 mb-4"
                  x-text="chartTitle"
                ></h2>
                <div id="chart-container" class="h-80" x-show="!isChartEmpty">
                  <canvas id="comparisonChart" x-ref="chartCanvas"></canvas>
                </div>
                <div
                  id="no-data-overlay"
                  x-show="isChartEmpty"
                  class="absolute inset-0 flex items-center justify-center bg-white/80 rounded-xl"
                >
                  <p class="text-lg font-semibold text-gray-500">
                    No data available for the selected period.
                  </p>
                </div>
              </div>
            </template>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
              <div>
                <div class="flex justify-between items-center">
                  <h2
                    id="your-hotel-table-title"
                    class="text-xl font-semibold text-gray-800"
                    x-text="currentPropertyName"
                  ></h2>
                </div>
                <p class="text-sm text-gray-500 -mt-2 mb-4">&nbsp;</p>
                <template x-if="isLoading.tables">
                  <div class="space-y-2 animate-pulse">
                    <div class="h-10 bg-gray-200 rounded-t-lg"></div>
                    <div class="h-12 bg-gray-200"></div>
                    <div class="h-12 bg-gray-200"></div>
                    <div class="h-12 bg-gray-200"></div>
                    <div class="h-12 bg-gray-200 rounded-b-lg"></div>
                  </div>
                </template>
                <template x-if="!isLoading.tables">
                  <div class="table-container rounded-lg overflow-x-auto">
                    <table class="w-full text-sm text-gray-600">
                      <thead
                        id="your-hotel-table-header"
                        class="bg-gray-50 sticky top-0"
                      >
                        <tr>
                          <th
                            class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                          >
                            Date
                          </th>
                          <th
                            class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                          >
                            Occupancy
                          </th>
                          <th
                            class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                          >
                            ADR
                          </th>
                          <th
                            class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                          >
                            RevPAR
                          </th>
                        </tr>
                      </thead>
                      <tbody
                        id="yourHotelTableBody"
                        class="divide-y divide-gray-200"
                      >
                        <template x-for="day in allMetrics" :key="day.date">
                          <tr class="hover:bg-blue-50">
                            <td
                              class="px-4 py-3 text-left font-data"
                              x-text="formatDateLabel(day.date, granularity)"
                            ></td>
                            <td
                              class="px-4 py-3 text-right font-data"
                              x-text="formatValue(day.your.occupancy, 'percent')"
                            ></td>
                            <td
                              class="px-4 py-3 text-right font-data"
                              x-text="formatValue(day.your.adr, 'currency')"
                            ></td>
                            <td
                              class="px-4 py-3 text-right font-data"
                              x-text="formatValue(day.your.revpar, 'currency')"
                            ></td>
                          </tr>
                        </template>
                        <template x-if="allMetrics.length === 0">
                          <tr>
                            <td
                              colspan="4"
                              class="text-center p-8 text-gray-500"
                            >
                              No data to display
                            </td>
                          </tr>
                        </template>
                      </tbody>
                    </table>
                  </div>
                </template>
              </div>
              <div>
                <h2 class="text-xl font-semibold text-gray-800 mb-4">
                  The Market
                </h2>
                <p
                  id="market-subtitle"
                  class="text-sm text-gray-500 -mt-2 mb-4"
                  x-text="marketSubtitle"
                ></p>
                <template x-if="isLoading.tables">
                  <div class="space-y-2 animate-pulse">
                    <div class="h-10 bg-gray-200 rounded-t-lg"></div>
                    <div class="h-12 bg-gray-200"></div>
                    <div class="h-12 bg-gray-200"></div>
                    <div class="h-12 bg-gray-200"></div>
                    <div class="h-12 bg-gray-200 rounded-b-lg"></div>
                  </div>
                </template>
                <template x-if="!isLoading.tables">
                  <div class="table-container rounded-lg overflow-x-auto">
                    <table class="w-full text-sm text-gray-600">
                      <thead
                        id="market-table-header"
                        class="bg-gray-50 sticky top-0"
                      >
                        <tr>
                          <th
                            class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                          >
                            Date
                          </th>
                          <th
                            class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                          >
                            Occupancy
                          </th>
                          <th
                            class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                          >
                            ADR
                          </th>
                          <th
                            class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                          >
                            RevPAR
                          </th>
                          <th
                            class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                          >
                            Delta
                          </th>
                        </tr>
                      </thead>
                      <tbody
                        id="marketTableBody"
                        class="divide-y divide-gray-200"
                      >
                        <template x-for="day in allMetrics" :key="day.date">
                          <tr class="hover:bg-blue-50">
                            <td
                              class="px-4 py-3 text-left font-data"
                              x-text="formatDateLabel(day.date, granularity)"
                            ></td>
                            <td
                              class="px-4 py-3 text-right font-data"
                              x-text="formatValue(day.market.occupancy, 'percent')"
                            ></td>
                            <td
                              class="px-4 py-3 text-right font-data"
                              x-text="formatValue(day.market.adr, 'currency')"
                            ></td>
                            <td
                              class="px-4 py-3 text-right font-data"
                              x-text="formatValue(day.market.revpar, 'currency')"
                            ></td>
                            <td
                              class="px-4 py-3 text-right font-semibold font-data"
                              :class="getDelta(day).deltaClass"
                              x-text="getDelta(day).formattedDelta"
                            ></td>
                          </tr>
                        </template>
                        <template x-if="allMetrics.length === 0">
                          <tr>
                            <td
                              colspan="5"
                              class="text-center p-8 text-gray-500"
                            >
                              No data to display
                            </td>
                          </tr>
                        </template>
                      </tbody>
                    </table>
                  </div>
                </template>
              </div>
            </div>
          </div>
        </main>
        <div
          x-show="isLegalModalOpen"
          x-transition:enter="ease-out duration-300"
          x-transition:enter-start="opacity-0"
          x-transition:enter-end="opacity-100"
          x-transition:leave="ease-in duration-200"
          x-transition:leave-start="opacity-100"
          x-transition:leave-end="opacity-0"
          class="fixed inset-0 z-50 flex items-center justify-center p-4"
          style="display: none"
        >
          <div @click="isLegalModalOpen = false" class="absolute inset-0"></div>

          <div
            @click.away="isLegalModalOpen = false"
            class="relative bg-white rounded-lg shadow-xl p-8 max-w-4xl w-full m-4 max-h-[80vh] overflow-y-auto"
          >
            <div class="flex justify-between items-center mb-6">
              <h2 class="text-2xl font-bold text-gray-800">
                Legal Information
              </h2>
              <button
                @click="isLegalModalOpen = false"
                class="text-gray-500 hover:text-gray-800"
              >
                <svg
                  class="w-6 h-6"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"
                  ></path>
                </svg>
              </button>
            </div>
            <div class="space-y-10">
              <div>
                <h3
                  class="text-xl font-semibold text-gray-800 border-b pb-2 mb-4"
                >
                  Terms of Service
                </h3>
                <div
                  class="prose prose-slate max-w-none text-sm prose-headings:mb-2 prose-p:mt-1 prose-p:leading-normal"
                >
                  <p><strong>Last Updated: July 9, 2025</strong></p>
                  <div>
                    <h5>Introduction</h5>
                    <p>
                      Welcome to Market Pulse. These Terms of Service ("Terms")
                      govern your access to and use of the services, websites,
                      and applications offered by Market Pulse ("Service"),
                      operated by <strong>ROCKENUE INTERNATIONAL GROUP</strong>.
                    </p>
                    <p>
                      By accessing or using our Service, you agree to be bound
                      by these Terms and our Privacy Policy. If you do not agree
                      to these Terms, you may not use the Service.
                    </p>
                  </div>
                  <div>
                    <h5>1. Description of Service</h5>
                    <p>
                      The Service provides hotel operators with a performance
                      analytics dashboard, market benchmarking tools, and other
                      data insights by accessing data from your connected
                      Property Management System (PMS) on a read-only basis.
                    </p>
                  </div>
                  <div>
                    <h5>2. Fees and Changes to Service</h5>
                    <p>
                      The core features of the Service are currently provided to
                      you free of charge. However, we reserve the right to
                      introduce fees for the use of the Service or for new
                      premium features in the future. We may also change our
                      business model at our sole discretion. We will provide you
                      with at least <strong>30 days' advance notice</strong> of
                      any such changes to fees or the business model. Your
                      continued use of the Service after a price change becomes
                      effective constitutes your agreement to pay the new
                      amount.
                    </p>
                  </div>
                  <div>
                    <h5>3. Intellectual Property and Data Rights</h5>
                    <h6>a) Our Intellectual Property</h6>
                    <p>
                      The Service and its original content, features, and
                      functionality are and will remain the exclusive property
                      of ROCKENUE INTERNATIONAL GROUP and its licensors.
                    </p>
                    <h6>b) License to Your Data</h6>
                    <p>
                      To operate and improve the Service, you grant us a
                      worldwide, perpetual, irrevocable, royalty-free license to
                      use, host, store, reproduce, modify, and create derivative
                      works from the data provided by your PMS. Specifically,
                      you agree that:
                    </p>
                    <ul class="list-disc list-inside space-y-2 pl-4">
                      <li>
                        We will use your hotel's performance data to power your
                        private dashboard.
                      </li>
                      <li>
                        We will use your hotel's performance data in an
                        <strong>anonymized and aggregated</strong> form,
                        combined with data from other hotels, to create market
                        analytics, reports, and other data-driven products.
                      </li>
                      <li>
                        These aggregated and anonymized data products may be
                        used to create new tools or be part of commercial
                        offerings sold to third parties (such as developers,
                        research agencies, or other businesses).
                      </li>
                      <li>
                        In any public or commercial use of this aggregated data,
                        your hotel's name, confidential information, or any
                        other personally identifiable information will
                        <strong>never</strong> be disclosed.
                      </li>
                    </ul>
                  </div>
                  <div>
                    <h5>4. User Conduct and Acceptable Use</h5>
                    <p>
                      You are responsible for all activities that occur under
                      your account. You agree not to: Use the Service for any
                      illegal or unauthorized purpose; Attempt to de-anonymize,
                      reverse-engineer, scrape, or otherwise steal the data,
                      source code, or core business ideas of the Service; or
                      Resell or sublicense your access to the Service.
                    </p>
                  </div>
                  <div>
                    <h5>5. Termination</h5>
                    <p>
                      You may terminate these Terms at any time by disconnecting
                      the Market Pulse application from within your PMS
                      settings. We may terminate or suspend your access to our
                      Service immediately, without prior notice or liability, if
                      you breach the Terms, particularly the "User Conduct and
                      Acceptable Use" section.
                    </p>
                  </div>
                  <div>
                    <h5>6. Data Withdrawal</h5>
                    <p>
                      In addition to your rights under our Privacy Policy, you
                      may request the removal of your specific hotel's
                      historical performance data from our active databases. To
                      do so, you must send a formal request to our support
                      email. We will process this request and remove the data as
                      is commercially reasonable. Please note that data already
                      included in historical, anonymized, and aggregated market
                      sets cannot be retroactively removed.
                    </p>
                  </div>
                  <div>
                    <h5>
                      7. Disclaimer of Warranties & Limitation of Liability
                    </h5>
                    <p>
                      The Service is provided on an "AS IS" and "AS AVAILABLE"
                      basis. We do not warrant that the service will be
                      uninterrupted, secure, or error-free. In no event shall
                      ROCKENUE INTERNATIONAL GROUP be liable for any indirect,
                      incidental, or consequential damages resulting from your
                      use of the Service.
                    </p>
                  </div>
                  <div>
                    <h5>8. Governing Law</h5>
                    <p>
                      These Terms shall be governed and construed in accordance
                      with the laws of the
                      <strong>United Arab Emirates</strong>, without regard to
                      its conflict of law provisions.
                    </p>
                  </div>
                  <div>
                    <h5>9. Contact Us</h5>
                    <p>
                      If you have any questions about these Terms, please
                      contact us at: <strong>support@market-pulse.io</strong>.
                    </p>
                  </div>
                </div>
              </div>
              <div>
                <h3
                  class="text-xl font-semibold text-gray-800 border-b pb-2 mb-4"
                >
                  Privacy Policy
                </h3>
                <div
                  class="prose prose-slate max-w-none text-sm prose-headings:mb-2 prose-p:mt-1 prose-p:leading-normal"
                >
                  <p><strong>Last Updated: July 9, 2025</strong></p>
                  <div>
                    <h5>Introduction</h5>
                    <p>
                      This Privacy Policy describes how Market Pulse, operated
                      by <strong>ROCKENUE INTERNATIONAL GROUP</strong> ("we",
                      "us", or "our"), collects, uses, and discloses your
                      information when you use our services. Our registered
                      address is 5842+632 Grand Stand, Nad Al Sheba 1, Dubai,
                      United Arab Emirates.
                    </p>
                  </div>
                  <div>
                    <h5>1. Information We Collect</h5>
                    <p>
                      We collect Personal Data (name, email), Hotel Performance
                      Data (read-only metrics like ADR, Occupancy), and Usage
                      Data (via essential session cookies and Google Analytics).
                    </p>
                  </div>
                  <div>
                    <h5>2. How We Use Your Information</h5>
                    <p>
                      We use your data to power your dashboard, create
                      anonymized market benchmarks, manage your account, and
                      improve the service.
                    </p>
                  </div>
                  <div>
                    <h5>3. Sharing and Disclosure of Information</h5>
                    <p>
                      We do not sell your personal or individual hotel data. We
                      share data only with essential third-party services like
                      Vercel, Neon, SendGrid, and Google Analytics for
                      operational purposes.
                    </p>
                  </div>
                  <div>
                    <h5>4. Data Retention</h5>
                    <p>
                      We have retained your Personal Data for 1 year after
                      account termination. Anonymized hotel data is retained
                      indefinitely for market analysis.
                    </p>
                  </div>
                  <div>
                    <h5>5. Your Data Protection Rights (GDPR)</h5>
                    <p>
                      You have the right to access, update, delete, or object to
                      the processing of your Personal Data. Please contact us to
                      exercise these rights.
                    </p>
                  </div>
                  <div>
                    <h5>6. Contact Us</h5>
                    <p>
                      If you have any questions about this Privacy Policy,
                      please contact us by email at:
                      <strong>support@market-pulse.io</strong>
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script type="module">
      import dashboard from "/app/dashboard.mjs";
      window.dashboardPage = function () {
        return dashboard;
      };
      // Load Alpine.js after our component is defined
      const alpineScript = document.createElement("script");
      alpineScript.src =
        "https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js";
      alpineScript.defer = true;
      document.head.appendChild(alpineScript);
    </script>
  </body>
</html>
