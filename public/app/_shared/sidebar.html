<aside
  class="w-72 min-w-72 lg:flex-shrink-0 flex flex-col bg-[#222831] text-white font-medium border-r border-[#2c333a] h-full"
  x-data="sidebar"
  x-cloak
>
  <div class="h-20 flex items-center px-4 flex-shrink-0">
    <img src="/logo.png" class="h-8 w-auto" alt="Market Pulse Logo" />
  </div>

  <div class="px-4 py-4">
    <div @click.away="propertyDropdownOpen = false" class="relative">
      <button
        @click="propertyDropdownOpen = !propertyDropdownOpen"
        class="flex items-center justify-between w-full rounded-lg border border-[#4e595e] px-3 py-2 text-base font-medium text-slate-300 hover:text-white transition-colors duration-200"
        :disabled="properties.length === 0"
      >
        <span x-text="currentPropertyName"></span>
        <svg
          class="h-4 w-4 text-gray-400"
          viewBox="0 0 20 20"
          fill="currentColor"
        >
          <path
            fill-rule="evenodd"
            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
            clip-rule="evenodd"
          ></path>
        </svg>
      </button>
      <div
        x-show="propertyDropdownOpen"
        x-transition
        class="absolute left-0 mt-2 w-full bg-white rounded-lg shadow-xl py-1 z-10 border"
      >
        <template x-for="property in properties" :key="property.property_id">
          <a
            href="#"
            @click.prevent="switchProperty(property.property_id)"
            class="block w-full text-left px-4 py-2 text-base text-gray-700 hover:bg-gray-100"
            x-text="property.property_name"
          ></a>
        </template>
        <template x-if="properties.length === 0">
          <p class="px-4 py-2 text-base text-gray-500">No properties found.</p>
        </template>
      </div>
    </div>
  </div>

  <nav class="flex-1 px-[10px] py-4 space-y-2">
    <a
      href="/app/"
      class="flex items-center w-full px-[10px] py-3 text-base rounded-lg transition-colors duration-200"
      :class="{
        'bg-[#393E46] text-white font-semibold': window.location.pathname.endsWith('/app/') || window.location.pathname.endsWith('index.html'),
        'text-[#555e61] hover:bg-[#393E46] hover:text-white font-medium': !(window.location.pathname.endsWith('/app/') || window.location.pathname.endsWith('index.html'))
      }"
    >
      <svg
        class="h-5 w-5 mr-3"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <rect x="3" y="3" width="7" height="7"></rect>
        <rect x="14" y="3" width="7" height="7"></rect>
        <rect x="14" y="14" width="7" height="7"></rect>
        <rect x="3" y="14" width="7" height="7"></rect>
      </svg>
      Dashboard
    </a>
    <a
      href="/app/reports.html"
      class="flex items-center w-full px-[10px] py-3 text-base rounded-lg transition-colors duration-200"
      :class="{
        'bg-[#393E46] text-white font-semibold': window.location.pathname.endsWith('reports.html'),
        'text-[#555e61] hover:bg-[#393E46] hover:text-white font-medium': !window.location.pathname.endsWith('reports.html')
      }"
    >
      <svg
        class="h-5 w-5 mr-3"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path
          d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"
        ></path>
        <polyline points="14 2 14 8 20 8"></polyline>
        <line x1="12" y1="18" x2="12" y2="12"></line>
        <line x1="9" y1="18" x2="9" y2="15"></line>
        <line x1="15" y1="18" x2="15" y2="9"></line>
      </svg>
      Reports
    </a>
    <a
      href="/app/settings.html"
      class="flex items-center w-full px-[10px] py-3 text-base rounded-lg transition-colors duration-200"
      :class="{
        'bg-[#393E46] text-white font-semibold': window.location.pathname.endsWith('settings.html'),
        'text-[#555e61] hover:bg-[#393E46] hover:text-white font-medium': !window.location.pathname.endsWith('settings.html')
      }"
    >
      <svg
        class="h-5 w-5 mr-3"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path
          d="M12.22 2h-4.44a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.36L18.88 4 12.22 2z"
        ></path>
        <path d="M18 2l-3.4 3.4"></path>
        <path d="M12 12l-4 4"></path>
        <path d="m22 2-3 3"></path>
        <path d="M15 15l-3 3"></path>
        <path d="M22 8l-3 3"></path>
        <path d="M9 9l-3 3"></path>
      </svg>
      Settings
    </a>
    <a
      id="admin-nav-link"
      href="/admin/"
      class="flex items-center w-full px-[10px] py-3 text-base rounded-lg transition-colors duration-200"
      x-show="isAdmin"
      style="display: none"
      :class="{ 'bg-[#393E46] text-white font-semibold': window.location.pathname.startsWith('/admin'), 'text-[#555e61] hover:bg-[#393E46] hover:text-white font-medium': !window.location.pathname.startsWith('/admin') }"
    >
      <svg
        class="h-5 w-5 mr-3"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
      </svg>
      Admin Panel
    </a>
  </nav>

  <div class="px-4 py-4 mt-auto">
    <div class="border-t border-slate-700 pt-4 space-y-4">
      <div class="flex items-center gap-3">
        <div class="w-8 flex justify-center items-center flex-shrink-0">
          <div class="relative flex h-3 w-3">
            <span
              class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"
            ></span>
            <span
              class="relative inline-flex rounded-full h-3 w-3 bg-green-500"
            ></span>
          </div>
        </div>
        <div class="text-xs text-slate-400 leading-tight">
          <span x-text="lastRefreshText.line1"></span><br />
          <span x-text="lastRefreshText.line2"></span>
        </div>
      </div>
      <div
        @click.away="userDropdownOpen = false"
        class="relative border-t border-slate-700 pt-4"
      >
        <div class="flex items-center justify-between w-full">
          <div class="flex items-center gap-3">
            <div
              class="h-8 w-8 rounded-full bg-blue-100 text-blue-600 font-bold flex items-center justify-center text-base flex-shrink-0"
            >
              <span x-text="user.initials"></span>
            </div>
            <p
              class="text-base font-semibold text-white"
              x-text="user.name"
            ></p>
          </div>
          <button
            @click="userDropdownOpen = !userDropdownOpen"
            class="text-slate-400 hover:text-white"
          >
            <svg
              class="h-6 w-6"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="1"></circle>
              <circle cx="19" cy="12" r="1"></circle>
              <circle cx="5" cy="12" r="1"></circle>
            </svg>
          </button>
        </div>
        <div
          x-show="userDropdownOpen"
          x-transition
          class="absolute bottom-full right-0 mb-2 w-48 bg-white rounded-lg shadow-xl py-1 z-10 border"
        >
          <button
            @click="openSupportModal(); userDropdownOpen = false"
            class="block w-full text-left px-4 py-2 text-base text-gray-700 hover:bg-gray-100"
          >
            Support & Help
          </button>
          <a
            href="/privacy.html"
            target="_blank"
            class="block px-4 py-2 text-base text-gray-700 hover:bg-gray-100"
          >
            Privacy Policy
          </a>
          <a
            href="/terms.html"
            target="_blank"
            class="block px-4 py-2 text-base text-gray-700 hover:bg-gray-100"
          >
            Terms of Service
          </a>
          <div class="border-t my-1"></div>
          <button
            @click="logout()"
            class="block w-full text-left px-4 py-2 text-base text-gray-700 hover:bg-gray-100"
          >
            Log Out
          </button>
        </div>
      </div>
    </div>
  </div>
</aside>
